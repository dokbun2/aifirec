<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>REC FREE</title>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #181818;
            color: #ffffff;
            overflow-x: hidden;
            overflow-y: auto;
            user-select: none;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 20px;
        }

        .app-container {
            width: 480px;
            height: 450px;
            display: flex;
            flex-direction: column;
            background: #2d2d2d;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow:
                0 0 0 1px rgba(0, 0, 0, 0.5),
                0 20px 60px rgba(0, 0, 0, 0.5),
                0 0 100px rgba(0, 0, 0, 0.3);
            overflow: hidden;
            position: relative;
        }
        
        .app-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, 
                transparent 0%, 
                rgba(255, 255, 255, 0.1) 50%, 
                transparent 100%);
            pointer-events: none;
        }

        .title-bar {
            height: 32px;
            background: #1a1a1a;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 10px;
            -webkit-app-region: drag;
        }

        .window-controls {
            display: flex;
            gap: 8px;
            -webkit-app-region: no-drag;
        }

        .window-btn {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            cursor: pointer;
        }

        .close-btn { background: #ff5f56; }
        .minimize-btn { background: #ffbd2e; }
        .maximize-btn { background: #27c93f; }

        .app-title {
            font-size: 13px;
            font-weight: 600;
            letter-spacing: 1px;
        }

        .pro-badge {
            background: #0078d4;
            color: white;
            padding: 3px 10px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
            margin-left: auto;
            margin-right: 10px;
        }

        .menu-icons {
            display: flex;
            gap: 10px;
            -webkit-app-region: no-drag;
        }

        .menu-icon {
            width: 20px;
            height: 20px;
            cursor: pointer;
            opacity: 0.7;
            transition: opacity 0.2s;
            color: #d0d0d0;
        }

        .menu-icon:hover {
            opacity: 1;
        }

        .toolbar {
            height: 90px;
            background: #2d2d2d;
            display: flex;
            align-items: center;
            padding: 0 15px;
            gap: 10px;
            border-bottom: 1px solid #1a1a1a;
        }

        .mode-btn {
            width: 80px;
            height: 60px;
            background: #3a3a3c;
            border: 1px solid #4a4a4c;
            border-radius: 4px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 8px;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }

        .mode-btn:hover {
            background: #404042;
        }

        .mode-btn.selected {
            background: #4a4a4c;
            border-color: #5a5a5c;
        }

        .mode-btn.selected::after {
            content: 'âœ“';
            position: absolute;
            top: 5px;
            left: 5px;
            color: #ff5252;
            font-size: 14px;
            font-weight: bold;
        }

        .mode-icon {
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #d0d0d0;
        }

        .mode-label {
            font-size: 11px;
            color: #d0d0d0;
        }

        .rec-button {
            width: 60px;
            height: 60px;
            background: #ff5252;
            border: 3px solid #ff5252;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
            margin-left: auto;
            position: relative;
        }

        .rec-button:hover {
            transform: scale(1.05);
            box-shadow: 0 0 20px rgba(255, 82, 82, 0.5);
        }

        .rec-button.recording {
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(255, 82, 82, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(255, 82, 82, 0); }
            100% { box-shadow: 0 0 0 0 rgba(255, 82, 82, 0); }
        }

        .rec-text {
            color: white;
            font-size: 16px;
            font-weight: bold;
        }

        .main-content {
            flex: 1;
            background: #1a1a1a;
            display: flex;
            flex-direction: column;
            padding: 20px;
            overflow-y: auto;
        }

        .window-selector {
            display: none;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
            margin-bottom: 30px;
        }

        .window-selector.active {
            display: flex;
        }

        .window-card {
            width: 200px;
            background: #2d2d2d;
            border: 2px solid #3a3a3c;
            border-radius: 8px;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.3s;
        }

        .window-card:hover {
            border-color: #5a5a5c;
            transform: translateY(-2px);
        }

        .window-card.selected {
            border-color: #0078d4;
        }

        .window-preview {
            height: 120px;
            background: #000;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 10px;
        }

        .window-icon {
            width: 40px;
            height: 40px;
            color: #5a5a5c;
        }

        .window-info {
            padding: 8px;
            background: #2d2d2d;
        }

        .window-title {
            font-size: 12px;
            color: #ffffff;
            margin-bottom: 3px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .window-type {
            font-size: 10px;
            color: #9a9a9a;
        }

        .info-text {
            text-align: center;
            color: #9a9a9a;
            font-size: 13px;
            margin-bottom: 20px;
        }

        .history-section {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #3a3a3c;
        }

        .section-header h3 {
            font-size: 16px;
            font-weight: 600;
            color: #ffffff;
        }

        .clear-btn {
            background: #3a3a3c;
            border: 1px solid #4a4a4c;
            color: #d0d0d0;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: all 0.2s;
        }

        .clear-btn:hover {
            background: #404042;
            color: #ff5252;
        }

        .history-list {
            flex: 1;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .history-item {
            background: #2d2d2d;
            border: 1px solid #3a3a3c;
            border-radius: 8px;
            padding: 12px;
            display: flex;
            align-items: center;
            gap: 12px;
            transition: all 0.2s;
        }

        .history-item:hover {
            background: #3a3a3c;
            border-color: #4a4a4c;
        }

        .history-icon {
            width: 40px;
            height: 40px;
            background: #3a3a3c;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #9a9a9a;
        }

        .history-info {
            flex: 1;
        }

        .history-name {
            font-size: 13px;
            color: #ffffff;
            margin-bottom: 4px;
        }

        .history-meta {
            font-size: 11px;
            color: #9a9a9a;
            display: flex;
            gap: 10px;
        }

        .history-actions {
            display: flex;
            gap: 8px;
        }

        .action-btn {
            width: 32px;
            height: 32px;
            background: #3a3a3c;
            border: 1px solid #4a4a4c;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
            color: #d0d0d0;
        }

        .action-btn:hover {
            background: #404042;
        }

        .action-btn.play:hover {
            color: #27c93f;
        }

        .action-btn.download:hover {
            color: #0078d4;
        }

        .action-btn.delete:hover {
            color: #ff5252;
        }

        .empty-state {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 10px;
            color: #9a9a9a;
        }

        .empty-state p {
            font-size: 14px;
            font-weight: 500;
        }

        .empty-state span {
            font-size: 12px;
            color: #5a5a5c;
        }

        .bottom-bar {
            height: 45px;
            background: #2d2d2d;
            border-top: 1px solid #3a3a3c;
            display: flex;
            align-items: center;
            padding: 0 15px;
            gap: 15px;
        }

        .control-btn {
            width: 28px;
            height: 28px;
            background: #3a3a3c;
            border: 1px solid #4a4a4c;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
        }

        .control-btn:hover:not(:disabled) {
            background: #404042;
        }

        .control-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .control-btn.active {
            background: #0078d4;
            border-color: #0078d4;
        }
        
        .control-btn.active .control-icon {
            color: white;
        }
        
        .control-btn.mic-off .control-icon {
            color: #ff5252;
        }

        .control-icon {
            width: 16px;
            height: 16px;
            color: #d0d0d0;
        }

        .status-info {
            margin-left: auto;
            display: flex;
            align-items: center;
            gap: 15px;
            font-size: 12px;
            color: #9a9a9a;
        }

        .status-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .status-value {
            color: #ffffff;
            font-weight: 600;
        }

        #previewVideo {
            display: none;
        }

        .placeholder-screen {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #5a5a5c;
            font-size: 14px;
        }

        .recording-timer {
            display: none;
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(255, 0, 0, 0.8);
            color: white;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
        }

        .recording .recording-timer {
            display: block;
        }

        #downloadLink {
            display: none;
            margin-top: 20px;
            text-align: center;
        }

        #downloadLink a {
            background: #0078d4;
            color: white;
            padding: 10px 20px;
            border-radius: 4px;
            text-decoration: none;
            display: inline-block;
            font-size: 13px;
            transition: background 0.2s;
        }

        #downloadLink a:hover {
            background: #106ebe;
        }

        .rec-icon {
            width: 24px;
            height: 24px;
            color: white;
        }

        /* ì„¤ì • ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
        .settings-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
        }

        .settings-modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .settings-container {
            width: 600px;
            height: 500px;
            background: #2d2d2d;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .settings-header {
            height: 50px;
            background: #1a1a1a;
            display: flex;
            align-items: center;
            padding: 0 20px;
            justify-content: space-between;
        }

        .settings-title {
            font-size: 16px;
            font-weight: 600;
            color: #ffffff;
        }

        .close-settings {
            width: 24px;
            height: 24px;
            cursor: pointer;
            color: #9a9a9a;
            transition: color 0.2s;
        }

        .close-settings:hover {
            color: #ffffff;
        }

        .settings-tabs {
            height: 50px;
            background: #232325;
            display: flex;
            border-bottom: 1px solid #1a1a1a;
        }

        .settings-tab {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            cursor: pointer;
            color: #9a9a9a;
            transition: all 0.2s;
            border-bottom: 2px solid transparent;
        }

        .settings-tab:hover {
            color: #d0d0d0;
        }

        .settings-tab.active {
            color: #0078d4;
            border-bottom-color: #0078d4;
        }

        .tab-icon {
            width: 18px;
            height: 18px;
        }

        .tab-label {
            font-size: 13px;
        }

        .settings-content {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }

        .settings-panel {
            display: none;
        }

        .settings-panel.active {
            display: block;
        }

        .setting-group {
            margin-bottom: 20px;
        }

        .setting-label {
            font-size: 13px;
            color: #d0d0d0;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .setting-input {
            width: 100%;
            height: 32px;
            background: #3a3a3c;
            border: 1px solid #4a4a4c;
            border-radius: 4px;
            color: #ffffff;
            padding: 0 10px;
            font-size: 12px;
        }

        .setting-select {
            width: 100%;
            height: 32px;
            background: #3a3a3c;
            border: 1px solid #4a4a4c;
            border-radius: 4px;
            color: #ffffff;
            padding: 0 10px;
            font-size: 12px;
            cursor: pointer;
        }

        .setting-checkbox {
            width: 18px;
            height: 18px;
            margin-right: 8px;
        }

        .checkbox-label {
            display: flex;
            align-items: center;
            font-size: 13px;
            color: #d0d0d0;
            cursor: pointer;
            margin-bottom: 8px;
        }

        .shortcut-input {
            width: 200px;
            height: 32px;
            background: #3a3a3c;
            border: 1px solid #4a4a4c;
            border-radius: 4px;
            color: #ffffff;
            padding: 0 10px;
            font-size: 12px;
            text-align: center;
        }

        .folder-selector {
            display: flex;
            gap: 10px;
        }

        .folder-input {
            flex: 1;
        }

        .browse-btn {
            width: 80px;
            height: 32px;
            background: #3a3a3c;
            border: 1px solid #4a4a4c;
            border-radius: 4px;
            color: #d0d0d0;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .browse-btn:hover {
            background: #404042;
        }

        .quality-slider {
            width: 100%;
            margin: 10px 0;
        }

        .slider-labels {
            display: flex;
            justify-content: space-between;
            font-size: 11px;
            color: #9a9a9a;
        }

        .settings-footer {
            height: 60px;
            background: #232325;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding: 0 20px;
            gap: 10px;
            border-top: 1px solid #1a1a1a;
        }

        .settings-btn {
            padding: 8px 20px;
            border-radius: 4px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s;
            border: none;
        }

        .settings-btn.cancel {
            background: #3a3a3c;
            color: #d0d0d0;
        }

        .settings-btn.cancel:hover {
            background: #404042;
        }

        .settings-btn.save {
            background: #0078d4;
            color: white;
        }

        .settings-btn.save:hover {
            background: #106ebe;
        }

        .countdown-setting {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .countdown-input {
            width: 60px;
        }
        
        /* ì• ë“œì„¼ìŠ¤ ì»¨í…Œì´ë„ˆ ìŠ¤íƒ€ì¼ */
        .ad-container {
            width: 100%;
            max-width: 520px;
            margin-top: 20px;
            padding: 15px;
            background: #2d2d2d;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow:
                0 0 0 1px rgba(0, 0, 0, 0.5),
                0 10px 30px rgba(0, 0, 0, 0.3);
            min-height: 100px;
        }

        .ad-header {
            font-size: 11px;
            color: #888;
            text-align: center;
            margin-bottom: 10px;
            letter-spacing: 0.5px;
        }

        /* ì• ë“œì„¼ìŠ¤ ë°˜ì‘í˜• ìµœì í™” */
        .adsbygoogle {
            display: block !important;
            width: 100% !important;
            min-height: 90px;
            background: rgba(255, 255, 255, 0.02);
            border-radius: 8px;
        }

        /* ë°˜ì‘í˜• ë””ìì¸ */
        @media (max-width: 520px) {
            .app-container {
                width: 100%;
                height: 60vh;
                max-height: 450px;
                border-radius: 0;
            }

            .ad-container {
                width: 100%;
                margin-top: 10px;
                border-radius: 0;
            }

            body {
                padding: 0;
            }
        }

        @media (min-width: 768px) {
            .app-container {
                width: 500px;
                height: 480px;
            }

            .ad-container {
                max-width: 500px;
            }
        }

        @media (min-width: 1024px) {
            .app-container {
                width: 520px;
                height: 500px;
            }

            .ad-container {
                max-width: 520px;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <div class="title-bar">
            <div class="app-title">REC FREE</div>
            <div class="menu-icons">
                <i data-lucide="folder" class="menu-icon" id="openFileBtn" title="ë…¹í™” íŒŒì¼ ì—´ê¸°"></i>
            </div>
        </div>
        
        <!-- íŒŒì¼ ì…ë ¥ (ìˆ¨ê¹€) -->
        <input type="file" id="fileInput" accept="video/*,.webm,.mp4,.avi,.mov" style="display: none;">

        <div class="toolbar">
            <button class="mode-btn selected" data-mode="screen">
                <i data-lucide="monitor" class="mode-icon"></i>
                <div class="mode-label">ë…¹í™” í•˜ê¸°</div>
            </button>
            
            <button class="mode-btn" id="settingsBtn" data-mode="settings">
                <i data-lucide="settings" class="mode-icon"></i>
                <div class="mode-label">í™˜ê²½ì„¤ì •</div>
            </button>
            
            <button class="rec-button" id="startBtn">
                <span class="rec-text">REC</span>
            </button>
        </div>

        <div class="main-content">
            
            
            <!-- ë…¹í™” íˆìŠ¤í† ë¦¬ ì„¹ì…˜ -->
            <div class="history-section">
                <div class="section-header">
                    <h3>ë…¹í™” íˆìŠ¤í† ë¦¬</h3>
                    <button class="clear-btn" id="clearCacheBtn">
                        <i data-lucide="trash-2" style="width: 16px; height: 16px;"></i>
                        ìºì‹œ ì‚­ì œ
                    </button>
                </div>
                
                <div class="history-list" id="historyList">
                    <!-- ë…¹í™”ëœ íŒŒì¼ë“¤ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                </div>
                
                <div class="empty-state" id="emptyState">
                    <i data-lucide="film" style="width: 48px; height: 48px; color: #5a5a5c;"></i>
                    <p>ë…¹í™”ëœ íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤</p>
                    <span>ë…¹í™”ë¥¼ ì‹œì‘í•˜ë ¤ë©´ REC ë²„íŠ¼ì„ ëˆ„ë¥´ì„¸ìš”</span>
                </div>
            </div>
            
            <!-- ë¯¸ë¦¬ë³´ê¸° ì˜ì—­ (ìˆ¨ê¹€) -->
            <video id="previewVideo" style="display: none;" muted autoplay></video>

            <div id="downloadLink">
                <a href="#" id="downloadAnchor">
                    <i data-lucide="download" style="width: 16px; height: 16px; display: inline-block; vertical-align: middle; margin-right: 5px;"></i>
                    ë…¹í™” íŒŒì¼ ë‹¤ìš´ë¡œë“œ
                </a>
            </div>
        </div>

        <div class="bottom-bar">
            <button class="control-btn" id="pauseBtn" disabled>
                <i data-lucide="pause" class="control-icon"></i>
            </button>
            <button class="control-btn" id="stopBtn" disabled>
                <i data-lucide="square" class="control-icon"></i>
            </button>
            <button class="control-btn" id="cameraBtn" title="ì›¹ìº  (ê°œë°œ ì¤‘)" disabled style="opacity: 0.3;">
                <i data-lucide="camera" class="control-icon"></i>
            </button>
            <button class="control-btn" id="micBtn" title="ë§ˆì´í¬ ì¼œê¸°/ë„ê¸°">
                <i data-lucide="mic" class="control-icon"></i>
            </button>
            
            <div class="status-info">
                <div class="status-item">
                    <span class="status-value">5K</span>
                </div>
                <div class="status-item">
                    <span>|</span>
                    <span class="status-value">60FPS</span>
                </div>
            </div>
        </div>
    </div>

    <!-- ì„¤ì • ëª¨ë‹¬ -->
    <div class="settings-modal" id="settingsModal">
        <div class="settings-container">
            <div class="settings-header">
                <div class="settings-title">í™˜ê²½ì„¤ì •</div>
                <i data-lucide="x" class="close-settings" id="closeSettings"></i>
            </div>
            
            <div class="settings-tabs">
                <div class="settings-tab active" data-tab="general">
                    <i data-lucide="settings" class="tab-icon"></i>
                    <span class="tab-label">ì¼ë°˜</span>
                </div>
                <div class="settings-tab" data-tab="video">
                    <i data-lucide="video" class="tab-icon"></i>
                    <span class="tab-label">ë¹„ë””ì˜¤</span>
                </div>
                <div class="settings-tab" data-tab="overlay">
                    <i data-lucide="monitor" class="tab-icon"></i>
                    <span class="tab-label">ì˜¤ë²„ë ˆì´</span>
                </div>
                <div class="settings-tab" data-tab="shortcuts">
                    <i data-lucide="keyboard" class="tab-icon"></i>
                    <span class="tab-label">ë‹¨ì¶•í‚¤</span>
                </div>
            </div>
            
            <div class="settings-content">
                <!-- ì¼ë°˜ ì„¤ì • -->
                <div class="settings-panel active" id="generalPanel">
                    <div class="setting-group">
                        <div class="setting-label">ì•± í…Œë§ˆ</div>
                        <select class="setting-select" id="themeSelect">
                            <option value="dark">ë‹¤í¬ ëª¨ë“œ</option>
                            <option value="light">ë¼ì´íŠ¸ ëª¨ë“œ</option>
                        </select>
                    </div>
                    
                    <div class="setting-group">
                        <div class="setting-label">ì˜µì…˜</div>
                        <label class="checkbox-label">
                            <input type="checkbox" class="setting-checkbox" id="startupCheck">
                            ë¡œê·¸ì¸ ì‹œ ì‹œì‘
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" class="setting-checkbox" id="desktopIconCheck">
                            ë°”íƒ• í™”ë©´ ì•„ì´ì½˜ ìº¡ì²˜ì—ì„œ ì œì™¸í•˜ê¸°
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" class="setting-checkbox" id="excludeSelfCheck" checked>
                            REC FREE ì‹¤í–‰ ìº¡ì²˜ì—ì„œ ì œì™¸
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" class="setting-checkbox" id="countdownCheck" checked>
                            ë…¹í™” ì‹œì‘ ì „ ì¹´ìš´íŠ¸ë‹¤ìš´
                            <div class="countdown-setting">
                                <input type="number" class="setting-input countdown-input" id="countdownValue" value="3" min="1" max="10">
                                <span style="color: #9a9a9a; font-size: 12px;">ì´ˆ</span>
                            </div>
                        </label>
                    </div>
                    
                    <div class="setting-group">
                        <div class="setting-label">ì¶œë ¥ í´ë”</div>
                        <div class="folder-selector">
                            <input type="text" class="setting-input folder-input" id="outputFolder" value="ë¸Œë¼ìš°ì € ë‹¤ìš´ë¡œë“œ í´ë”" readonly style="opacity: 0.7;">
                            <button class="browse-btn" disabled style="opacity: 0.5; cursor: not-allowed;">ì°¾ì•„ë³´ê¸°</button>
                        </div>
                        <div style="margin-top: 8px; padding: 8px; background: rgba(255, 152, 0, 0.1); border-radius: 4px;">
                            <p style="font-size: 11px; color: #ff9800; margin: 0;">
                                <i data-lucide="info" style="width: 12px; height: 12px; display: inline-block; vertical-align: middle; margin-right: 4px;"></i>
                                ì›¹ ë¸Œë¼ìš°ì €ì—ì„œëŠ” ë³´ì•ˆìƒ ë‹¤ìš´ë¡œë“œ í´ë”ë¥¼ ì§€ì •í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.<br>
                                íŒŒì¼ì€ ë¸Œë¼ìš°ì €ì˜ ê¸°ë³¸ ë‹¤ìš´ë¡œë“œ í´ë”ì— ì €ì¥ë©ë‹ˆë‹¤.<br>
                                <span style="color: #9a9a9a;">ì¼ë°˜ì ìœ¼ë¡œ: ~/Downloads ë˜ëŠ” ~/ë‹¤ìš´ë¡œë“œ</span>
                            </p>
                        </div>
                        <label class="checkbox-label" style="margin-top: 10px;">
                            <input type="checkbox" class="setting-checkbox" id="showAfterRecord" checked>
                            ë…¹í™” í›„ ì¶œë ¥ ë¹„ë””ì˜¤ í‘œì‹œí•˜ê¸°
                        </label>
                    </div>
                </div>
                
                <!-- ë¹„ë””ì˜¤ ì„¤ì • -->
                <div class="settings-panel" id="videoPanel">
                    <div class="setting-group">
                        <div class="setting-label">í˜•ì‹</div>
                        <div style="display: flex; gap: 10px;">
                            <div style="flex: 1;">
                                <div style="font-size: 11px; color: #9a9a9a; margin-bottom: 5px;">íŒŒì¼ í˜•ì‹</div>
                                <select class="setting-select" id="formatSelect">
                                    <option value="mp4">MP4</option>
                                    <option value="webm">WebM</option>
                                    <option value="avi">AVI</option>
                                    <option value="mov">MOV</option>
                                </select>
                            </div>
                            <div style="flex: 1;">
                                <div style="font-size: 11px; color: #9a9a9a; margin-bottom: 5px;">ì½”ë±</div>
                                <select class="setting-select" id="codecSelect">
                                    <option value="h264">H.264</option>
                                    <option value="h265">H.265</option>
                                    <option value="vp8">VP8</option>
                                    <option value="vp9">VP9</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="setting-group">
                        <div class="setting-label">
                            <span>í’ˆì§ˆ</span>
                            <select class="setting-select" style="width: 100px;" id="qualityMode">
                                <option value="vbr">VBR</option>
                                <option value="cbr">CBR</option>
                            </select>
                        </div>
                        <input type="range" class="quality-slider" id="qualitySlider" min="0" max="100" value="50">
                        <div class="slider-labels">
                            <span>0</span>
                            <span id="qualityValue">50</span>
                            <span>100</span>
                        </div>
                    </div>
                    
                    <div class="setting-group">
                        <div class="setting-label">ìµœëŒ€ í•´ìƒë„</div>
                        <select class="setting-select" id="resolutionSelect">
                            <option value="5k">5K UHD (5120x2880)</option>
                            <option value="4k">4K UHD (3840x2160)</option>
                            <option value="1080p">Full HD (1920x1080)</option>
                            <option value="720p">HD (1280x720)</option>
                        </select>
                    </div>
                    
                    <div class="setting-group">
                        <div class="setting-label">FPS</div>
                        <select class="setting-select" id="fpsSelect">
                            <option value="60">60</option>
                            <option value="30">30</option>
                            <option value="24">24</option>
                            <option value="15">15</option>
                        </select>
                    </div>
                    
                    <div class="setting-group">
                        <div class="setting-label">ì˜¤ë””ì˜¤</div>
                        <div style="display: flex; gap: 10px;">
                            <div style="flex: 1;">
                                <div style="font-size: 11px; color: #9a9a9a; margin-bottom: 5px;">ì½”ë±</div>
                                <select class="setting-select" id="audioCodec">
                                    <option value="aac">AAC</option>
                                    <option value="mp3">MP3</option>
                                    <option value="opus">Opus</option>
                                </select>
                            </div>
                            <div style="flex: 1;">
                                <div style="font-size: 11px; color: #9a9a9a; margin-bottom: 5px;">í’ˆì§ˆ</div>
                                <select class="setting-select" id="audioBitrate">
                                    <option value="256">ë†’ìŒ - 256Kbps</option>
                                    <option value="192">ì¤‘ê°„ - 192Kbps</option>
                                    <option value="128">ë‚®ìŒ - 128Kbps</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="setting-group">
                        <div class="setting-label">ìŠ¤í”¼ì»¤ ë° ë§ˆì´í¬</div>
                        <label class="checkbox-label">
                            <input type="checkbox" class="setting-checkbox" id="speakerCheck" checked>
                            ìŠ¤í”¼ì»¤ ì˜¤ë””ì˜¤ ë…¹ìŒí•˜ê¸°
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" class="setting-checkbox" id="micCheck">
                            ë§ˆì´í¬ ì˜¤ë””ì˜¤ ë…¹ìŒí•˜ê¸°
                        </label>
                        <select class="setting-select" id="micSelect" style="margin-top: 10px; display: none;">
                            <option>MacBook Pro ë§ˆì´í¬</option>
                        </select>
                    </div>
                </div>
                
                <!-- ì˜¤ë²„ë ˆì´ ì„¤ì • -->
                <div class="settings-panel" id="overlayPanel">
                    <div class="setting-group">
                        <label class="checkbox-label">
                            <input type="checkbox" class="setting-checkbox" id="cursorCheck" checked>
                            ì¶œë ¥ ì˜ìƒì— ì»¤ì„œ ì¶”ê°€í•˜ê¸°
                        </label>
                    </div>
                    
                    <div class="setting-group">
                        <label class="checkbox-label">
                            <input type="checkbox" class="setting-checkbox" id="webcamCheck">
                            í™”ë©´ì— ì›¹ìº  ë¹„ë””ì˜¤ í‘œì‹œí•˜ê¸°
                        </label>
                        <select class="setting-select" id="webcamSelect" style="margin-top: 10px; display: none;">
                            <option>FaceTime HD ì¹´ë©”ë¼ (ë‚´ì¥í˜•)</option>
                        </select>
                        <div style="margin-top: 10px; display: none;" id="webcamOptions">
                            <label class="checkbox-label">
                                <input type="checkbox" class="setting-checkbox" id="webcamMirror">
                                ë¯¸ë¦¬
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" class="setting-checkbox" id="webcamFlip">
                                ì„¸ë¡œë¡œ ë’¤ì§‘ê¸°
                            </label>
                        </div>
                    </div>
                </div>
                
                <!-- ë‹¨ì¶•í‚¤ ì„¤ì • -->
                <div class="settings-panel" id="shortcutsPanel">
                    <div class="setting-group">
                        <div class="setting-label">
                            <span>í˜„ì¬ í™”ë©´ ë…¹í™”</span>
                            <input type="text" class="shortcut-input" id="recordShortcut" placeholder="í´ë¦­ í›„ ë‹¨ì¶•í‚¤ ì…ë ¥" data-action="record">
                        </div>
                    </div>
                    
                    <div class="setting-group">
                        <div class="setting-label">
                            <span>í˜„ì¬ ìœˆë„ìš° ë…¹í™”</span>
                            <input type="text" class="shortcut-input" id="windowShortcut" placeholder="í´ë¦­ í›„ ë‹¨ì¶•í‚¤ ì…ë ¥" data-action="window">
                        </div>
                    </div>
                    
                    <div class="setting-group">
                        <div class="setting-label">
                            <span>ë…¹í™” ì¤‘ë‹¨</span>
                            <input type="text" class="shortcut-input" id="stopShortcut" placeholder="í´ë¦­ í›„ ë‹¨ì¶•í‚¤ ì…ë ¥" data-action="stop">
                        </div>
                    </div>
                    
                    <div class="setting-group">
                        <div class="setting-label">
                            <span>ì¼ì‹œ ì •ì§€ / ì¬ê°œ</span>
                            <input type="text" class="shortcut-input" id="pauseShortcut" placeholder="í´ë¦­ í›„ ë‹¨ì¶•í‚¤ ì…ë ¥" data-action="pause">
                        </div>
                    </div>
                    
                    <div style="margin-top: 20px; padding: 10px; background: #3a3a3c; border-radius: 4px;">
                        <p style="font-size: 11px; color: #9a9a9a; margin: 0;">
                            ğŸ’¡ ë‹¨ì¶•í‚¤ ë“±ë¡ ë°©ë²•: ì…ë ¥ í•„ë“œë¥¼ í´ë¦­í•œ í›„ ì›í•˜ëŠ” í‚¤ ì¡°í•©ì„ ëˆ„ë¥´ì„¸ìš”.<br>
                            ì˜ˆì‹œ: Ctrl+Alt+R, Cmd+Shift+S ë“±
                        </p>
                    </div>
                </div>
            </div>
            
            <div class="settings-footer">
                <button class="settings-btn cancel" id="cancelSettings">ì·¨ì†Œ</button>
                <button class="settings-btn save" id="saveSettings">ì €ì¥</button>
            </div>
        </div>
    </div>

    <script>
        // Lucide ì•„ì´ì½˜ ì´ˆê¸°í™”
        lucide.createIcons();

        let mediaRecorder = null;
        let stream = null;
        let recordedChunks = [];
        let isRecording = false;
        let isPaused = false;
        let startTime = null;
        let timerInterval = null;
        let recordingHistory = JSON.parse(localStorage.getItem('recordingHistory') || '[]');
        
        // ë””ë²„ê¹…ì„ ìœ„í•œ ì „ì—­ ë³€ìˆ˜ ë…¸ì¶œ
        window.mediaRecorder = mediaRecorder;
        window.stream = stream;
        window.isRecording = isRecording;

        const startBtn = document.getElementById('startBtn');
        const pauseBtn = document.getElementById('pauseBtn');
        const stopBtn = document.getElementById('stopBtn');
        const previewVideo = document.getElementById('previewVideo');
        const placeholder = document.getElementById('placeholder');
        const recordingTime = document.getElementById('recordingTime');
        const downloadLink = document.getElementById('downloadLink');
        const downloadAnchor = document.getElementById('downloadAnchor');
        const openFileBtn = document.getElementById('openFileBtn');
        const fileInput = document.getElementById('fileInput');
        const micBtn = document.getElementById('micBtn');

        // ë…¹í™” ì‹œì‘/ì¤‘ì§€
        startBtn.addEventListener('click', async () => {
            if (!isRecording) {
                await startRecording();
            } else {
                stopRecording();
            }
        });

        // ì¼ì‹œì •ì§€
        pauseBtn.addEventListener('click', () => {
            if (!pauseBtn.disabled) {
                if (isPaused) {
                    resumeRecording();
                } else {
                    pauseRecording();
                }
            }
        });

        // ì¤‘ì§€
        stopBtn.addEventListener('click', () => {
            if (!stopBtn.disabled) {
                stopRecording();
            }
        });

        async function startRecording() {
            try {
                console.log('í™”ë©´ ê³µìœ  ì‹œì‘ ì‹œë„...');
                
                // í™”ë©´ ê³µìœ  ìŠ¤íŠ¸ë¦¼ ê°€ì ¸ì˜¤ê¸°
                stream = await navigator.mediaDevices.getDisplayMedia({
                    video: {
                        width: { ideal: 1920 },
                        height: { ideal: 1080 },
                        frameRate: { ideal: 60 }
                    },
                    audio: {
                        echoCancellation: true,
                        noiseSuppression: true,
                        sampleRate: 48000,
                        sampleSize: 16,
                        channelCount: 2
                    }
                });

                console.log('ìŠ¤íŠ¸ë¦¼ íšë“ ì„±ê³µ:', stream);
                
                // ë§ˆì´í¬ ì˜¤ë””ì˜¤ ì¶”ê°€ (ì„¤ì •ì—ì„œ í™œì„±í™”ëœ ê²½ìš°)
                if (appSettings.video.recordMic) {
                    try {
                        console.log('ë§ˆì´í¬ ì˜¤ë””ì˜¤ ê°€ì ¸ì˜¤ê¸°...');
                        const micStream = await navigator.mediaDevices.getUserMedia({
                            audio: {
                                echoCancellation: true,
                                noiseSuppression: true,
                                autoGainControl: true,
                                sampleRate: 48000,
                                sampleSize: 16,
                                channelCount: 2
                            },
                            video: false
                        });
                        
                        // ì˜¤ë””ì˜¤ ì»¨í…ìŠ¤íŠ¸ ìƒì„±
                        const audioContext = new AudioContext();
                        const destination = audioContext.createMediaStreamDestination();
                        
                        // ì‹œìŠ¤í…œ ì˜¤ë””ì˜¤ íŠ¸ë™ì´ ìˆëŠ” ê²½ìš° ë¯¹ì‹±
                        const systemAudioTracks = stream.getAudioTracks();
                        if (systemAudioTracks.length > 0) {
                            const systemSource = audioContext.createMediaStreamSource(new MediaStream([systemAudioTracks[0]]));
                            const systemGain = audioContext.createGain();
                            systemGain.gain.value = 1.0; // ì‹œìŠ¤í…œ ì˜¤ë””ì˜¤ ë³¼ë¥¨
                            systemSource.connect(systemGain);
                            systemGain.connect(destination);
                        }
                        
                        // ë§ˆì´í¬ ì˜¤ë””ì˜¤ ì¶”ê°€
                        const micSource = audioContext.createMediaStreamSource(micStream);
                        const micGain = audioContext.createGain();
                        micGain.gain.value = 1.0; // ë§ˆì´í¬ ë³¼ë¥¨
                        micSource.connect(micGain);
                        micGain.connect(destination);
                        
                        // ê¸°ì¡´ ì˜¤ë””ì˜¤ íŠ¸ë™ ì œê±°í•˜ê³  ë¯¹ì‹±ëœ ì˜¤ë””ì˜¤ ì¶”ê°€
                        stream.getAudioTracks().forEach(track => stream.removeTrack(track));
                        destination.stream.getAudioTracks().forEach(track => stream.addTrack(track));
                        
                        console.log('ë§ˆì´í¬ ì˜¤ë””ì˜¤ ë¯¹ì‹± ì™„ë£Œ');
                    } catch (micError) {
                        console.error('ë§ˆì´í¬ ì˜¤ë””ì˜¤ ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨:', micError);
                        alert('ë§ˆì´í¬ ì ‘ê·¼ ê¶Œí•œì´ ê±°ë¶€ë˜ì—ˆìŠµë‹ˆë‹¤. ì‹œìŠ¤í…œ ì˜¤ë””ì˜¤ë§Œ ë…¹ìŒë©ë‹ˆë‹¤.');
                    }
                }
                
                // ìŠ¤íŠ¸ë¦¼ ìœ íš¨ì„± ê²€ì¦
                const videoTracks = stream.getVideoTracks();
                if (!videoTracks || videoTracks.length === 0) {
                    throw new Error('ë¹„ë””ì˜¤ íŠ¸ë™ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                }

                // ë¯¸ë¦¬ë³´ê¸° í‘œì‹œ (í˜„ì¬ëŠ” ìˆ¨ê¹€ ì²˜ë¦¬)
                previewVideo.srcObject = stream;
                // previewVideo.style.display = 'block'; // ë¯¸ë¦¬ë³´ê¸° ë¹„í™œì„±í™”

                // MediaRecorder ì„¤ì • - ê³ í’ˆì§ˆ ì˜¤ë””ì˜¤ ì„¤ì •
                let options = {
                    mimeType: 'video/webm;codecs=vp9,opus',
                    videoBitsPerSecond: 5000000, // 5 Mbps for video
                    audioBitsPerSecond: 256000   // 256 kbps for audio (ê³ í’ˆì§ˆ)
                };

                // ì½”ë± ì§€ì› í™•ì¸ ë° ëŒ€ì²´
                if (!MediaRecorder.isTypeSupported(options.mimeType)) {
                    console.log('VP9 ì§€ì› ì•ˆí•¨, VP8ë¡œ ë³€ê²½');
                    options.mimeType = 'video/webm;codecs=vp8,opus';
                    
                    if (!MediaRecorder.isTypeSupported(options.mimeType)) {
                        console.log('VP8ë„ ì§€ì› ì•ˆí•¨, ê¸°ë³¸ webmìœ¼ë¡œ ë³€ê²½');
                        options = {
                            mimeType: 'video/webm',
                            videoBitsPerSecond: 5000000,
                            audioBitsPerSecond: 256000
                        };
                    }
                }

                mediaRecorder = new MediaRecorder(stream, options);
                recordedChunks = [];

                mediaRecorder.ondataavailable = (event) => {
                    if (event.data.size > 0) {
                        recordedChunks.push(event.data);
                        console.log('ë°ì´í„° ì²­í¬ ì¶”ê°€:', event.data.size, 'bytes');
                    }
                };

                mediaRecorder.onstop = () => {
                    console.log('MediaRecorder ì¤‘ì§€ë¨');
                    handleStop();
                };

                mediaRecorder.onerror = (event) => {
                    console.error('MediaRecorder ì—ëŸ¬:', event.error);
                };

                // í™”ë©´ ê³µìœ  ì¢…ë£Œ ê°ì§€
                const videoTrack = videoTracks[0];
                if (videoTrack) {
                    videoTrack.onended = () => {
                        console.log('ì‚¬ìš©ìê°€ í™”ë©´ ê³µìœ ë¥¼ ì¤‘ì§€í–ˆìŠµë‹ˆë‹¤.');
                        if (isRecording) {
                            stopRecording();
                            alert('í™”ë©´ ê³µìœ ê°€ ì¤‘ì§€ë˜ì–´ ë…¹í™”ê°€ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.');
                        }
                    };
                    
                    // íŠ¸ë™ ìƒíƒœ ëª¨ë‹ˆí„°ë§
                    videoTrack.addEventListener('mute', () => {
                        console.log('ë¹„ë””ì˜¤ íŠ¸ë™ì´ ìŒì†Œê±°ë˜ì—ˆìŠµë‹ˆë‹¤.');
                    });
                    
                    console.log('ë¹„ë””ì˜¤ íŠ¸ë™ ìƒíƒœ:', {
                        enabled: videoTrack.enabled,
                        muted: videoTrack.muted,
                        readyState: videoTrack.readyState,
                        label: videoTrack.label
                    });
                }

                // ë…¹í™” ì‹œì‘
                mediaRecorder.start(1000); // 1ì´ˆë§ˆë‹¤ ë°ì´í„° ìˆ˜ì§‘
                isRecording = true;
                startTime = Date.now();
                
                // ì „ì—­ ë³€ìˆ˜ ì—…ë°ì´íŠ¸
                window.mediaRecorder = mediaRecorder;
                window.stream = stream;
                window.isRecording = isRecording;
                
                console.log('ë…¹í™” ì‹œì‘ë¨');

                // UI ì—…ë°ì´íŠ¸
                startBtn.classList.add('recording');
                startBtn.innerHTML = '<span class="rec-text">STOP</span>';
                pauseBtn.disabled = false;
                stopBtn.disabled = false;

                // íƒ€ì´ë¨¸ ì‹œì‘
                startTimer();

            } catch (error) {
                console.error('ë…¹í™” ì‹œì‘ ì‹¤íŒ¨:', error);
                
                // ì—ëŸ¬ ë©”ì‹œì§€ ê°œì„ 
                let errorMessage = '';
                
                if (error.name === 'NotAllowedError' || error.message.includes('denied')) {
                    errorMessage = 'í™”ë©´ ë…¹í™”ë¥¼ ì‹œì‘í•˜ë ¤ë©´ í™”ë©´ì„ ì„ íƒí•´ì£¼ì„¸ìš”.\n\nì·¨ì†Œí•˜ì…¨ë‹¤ë©´ ë‹¤ì‹œ REC ë²„íŠ¼ì„ ëˆ„ë¥´ê³  í™”ë©´ì„ ì„ íƒí•´ì£¼ì„¸ìš”.';
                } else if (error.name === 'NotFoundError') {
                    errorMessage = 'í™”ë©´ ê³µìœ ë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\në¸Œë¼ìš°ì €ê°€ í™”ë©´ ê³µìœ ë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.';
                } else if (error.name === 'NotReadableError') {
                    errorMessage = 'í™”ë©´ì„ ì½ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\në‹¤ë¥¸ ì•±ì´ í™”ë©´ì„ ì‚¬ìš© ì¤‘ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.';
                } else {
                    errorMessage = `í™”ë©´ ë…¹í™”ë¥¼ ì‹œì‘í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\n\nì—ëŸ¬: ${error.message}`;
                }
                
                alert(errorMessage);
                
                // UI ì´ˆê¸°í™”
                isRecording = false;
                startBtn.classList.remove('recording');
                startBtn.innerHTML = '<span class="rec-text">REC</span>';
            }
        }

        function pauseRecording() {
            if (mediaRecorder && mediaRecorder.state === 'recording') {
                mediaRecorder.pause();
                isPaused = true;
                pauseBtn.innerHTML = '<i data-lucide="play" class="control-icon"></i>';
                lucide.createIcons();
                clearInterval(timerInterval);
            }
        }

        function resumeRecording() {
            if (mediaRecorder && mediaRecorder.state === 'paused') {
                mediaRecorder.resume();
                isPaused = false;
                pauseBtn.innerHTML = '<i data-lucide="pause" class="control-icon"></i>';
                lucide.createIcons();
                startTimer();
            }
        }

        function stopRecording() {
            if (mediaRecorder && mediaRecorder.state !== 'inactive') {
                mediaRecorder.stop();
                
                // ìŠ¤íŠ¸ë¦¼ ì •ì§€
                if (stream) {
                    stream.getTracks().forEach(track => track.stop());
                }

                // UI ì—…ë°ì´íŠ¸
                isRecording = false;
                isPaused = false;
                
                // ì „ì—­ ë³€ìˆ˜ ì—…ë°ì´íŠ¸
                window.isRecording = false;
                window.mediaRecorder = null;
                window.stream = null;
                
                startBtn.classList.remove('recording');
                startBtn.innerHTML = '<span class="rec-text">REC</span>';
                pauseBtn.disabled = true;
                stopBtn.disabled = true;
                pauseBtn.innerHTML = '<i data-lucide="pause" class="control-icon"></i>';
                lucide.createIcons();

                // íƒ€ì´ë¨¸ ì¤‘ì§€
                clearInterval(timerInterval);
            }
        }

        function handleStop() {
            const blob = new Blob(recordedChunks, { type: 'video/webm' });
            
            // ë…¹í™” ì •ë³´ ì €ì¥ (íŒŒì¼ ë°ì´í„°ëŠ” ì €ì¥í•˜ì§€ ì•ŠìŒ)
            const timestamp = new Date().toISOString().replace(/[:.]/g, '-');
            const fileName = `rec_free_${timestamp}.webm`;
            const recordingData = {
                id: Date.now(),
                name: fileName,
                size: blob.size,
                date: new Date().toISOString(),
                duration: getRecordingDuration()
                // data í•„ë“œ ì œê±° - íŒŒì¼ì€ ë¡œì»¬ì— ì§ì ‘ ë‹¤ìš´ë¡œë“œ
            };
            
            // íˆìŠ¤í† ë¦¬ì— ì¶”ê°€ (ë©”íƒ€ë°ì´í„°ë§Œ)
            recordingHistory.unshift(recordingData);
            if (recordingHistory.length > 50) { // ë©”íƒ€ë°ì´í„°ë§Œ ì €ì¥í•˜ë¯€ë¡œ ë” ë§ì´ ì €ì¥ ê°€ëŠ¥
                recordingHistory = recordingHistory.slice(0, 50);
            }
            
            // localStorageì— ë©”íƒ€ë°ì´í„°ë§Œ ì €ì¥
            try {
                localStorage.setItem('recordingHistory', JSON.stringify(recordingHistory));
            } catch (e) {
                console.error('localStorage ì €ì¥ ì‹¤íŒ¨:', e);
                // ì˜¤ë˜ëœ í•­ëª© ì‚­ì œ
                recordingHistory = recordingHistory.slice(0, 25);
                localStorage.setItem('recordingHistory', JSON.stringify(recordingHistory));
            }
            
            // íˆìŠ¤í† ë¦¬ UI ì—…ë°ì´íŠ¸
            updateHistoryUI();
            
            // ë‹¤ìš´ë¡œë“œ ë§í¬ ìƒì„± ë° ìë™ ë‹¤ìš´ë¡œë“œ
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = fileName;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            
            // ë©”ëª¨ë¦¬ ì •ë¦¬
            setTimeout(() => {
                URL.revokeObjectURL(url);
            }, 1000);
            
            // ë‹¤ìš´ë¡œë“œ ì™„ë£Œ ì•Œë¦¼
            const downloadLink = document.getElementById('downloadLink');
            downloadLink.innerHTML = `
                <div style="color: #27c93f; padding: 10px; background: rgba(39, 201, 63, 0.1); border-radius: 4px;">
                    <i data-lucide="check-circle" style="width: 16px; height: 16px; display: inline-block; vertical-align: middle; margin-right: 5px;"></i>
                    ${fileName} ë‹¤ìš´ë¡œë“œ ì™„ë£Œ
                </div>
            `;
            downloadLink.style.display = 'block';
            
            // Lucide ì•„ì´ì½˜ ì¬ìƒì„±
            lucide.createIcons();
            
            // 3ì´ˆ í›„ ë©”ì‹œì§€ ìˆ¨ê¸°ê¸°
            setTimeout(() => {
                downloadLink.style.display = 'none';
            }, 3000);
        }
        
        function getRecordingDuration() {
            const elapsed = Math.floor((Date.now() - startTime) / 1000);
            const minutes = Math.floor(elapsed / 60);
            const seconds = elapsed % 60;
            return `${minutes}:${seconds.toString().padStart(2, '0')}`;
        }
        
        function updateHistoryUI() {
            const historyList = document.getElementById('historyList');
            const emptyState = document.getElementById('emptyState');
            
            if (recordingHistory.length === 0) {
                historyList.style.display = 'none';
                emptyState.style.display = 'flex';
            } else {
                historyList.style.display = 'flex';
                emptyState.style.display = 'none';
                
                historyList.innerHTML = recordingHistory.map(item => `
                    <div class="history-item">
                        <div class="history-icon">
                            <i data-lucide="video" style="width: 20px; height: 20px;"></i>
                        </div>
                        <div class="history-info">
                            <div class="history-name">${item.name}</div>
                            <div class="history-meta">
                                <span>${formatFileSize(item.size)}</span>
                                <span>â€¢</span>
                                <span>${item.duration}</span>
                                <span>â€¢</span>
                                <span>${formatDate(item.date)}</span>
                            </div>
                        </div>
                        <div class="history-actions">
                            <button class="action-btn play" onclick="playRecording('${item.id}')">
                                <i data-lucide="play" style="width: 16px; height: 16px;"></i>
                            </button>
                            <button class="action-btn download" onclick="downloadRecording('${item.id}')">
                                <i data-lucide="download" style="width: 16px; height: 16px;"></i>
                            </button>
                            <button class="action-btn delete" onclick="deleteRecording('${item.id}')">
                                <i data-lucide="trash-2" style="width: 16px; height: 16px;"></i>
                            </button>
                        </div>
                    </div>
                `).join('');
                
                // Lucide ì•„ì´ì½˜ ì¬ìƒì„±
                lucide.createIcons();
            }
        }
        
        function formatFileSize(bytes) {
            const mb = bytes / (1024 * 1024);
            return `${mb.toFixed(2)} MB`;
        }
        
        function formatDate(dateString) {
            const date = new Date(dateString);
            const now = new Date();
            const diffMs = now - date;
            const diffMins = Math.floor(diffMs / 60000);
            
            if (diffMins < 1) return 'ë°©ê¸ˆ ì „';
            if (diffMins < 60) return `${diffMins}ë¶„ ì „`;
            if (diffMins < 1440) return `${Math.floor(diffMins / 60)}ì‹œê°„ ì „`;
            return date.toLocaleDateString('ko-KR');
        }
        
        function playRecording(id) {
            const recording = recordingHistory.find(r => r.id == id);
            if (recording) {
                // Base64 ë°ì´í„°ê°€ ìˆëŠ” ê²½ìš°
                if (recording.data) {
                    // ìƒˆ ì°½ì—ì„œ ë¹„ë””ì˜¤ ì¬ìƒ
                    const videoWindow = window.open('', '_blank', 'width=800,height=600');
                    if (videoWindow) {
                        videoWindow.document.write(`
                            <!DOCTYPE html>
                            <html>
                            <head>
                                <title>${recording.name} - REC FREE Player</title>
                                <style>
                                    body {
                                        margin: 0;
                                        padding: 0;
                                        background: #000;
                                        display: flex;
                                        justify-content: center;
                                        align-items: center;
                                        height: 100vh;
                                        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
                                    }
                                    video {
                                        max-width: 100%;
                                        max-height: 100%;
                                        width: auto;
                                        height: auto;
                                    }
                                    .controls {
                                        position: fixed;
                                        bottom: 20px;
                                        left: 50%;
                                        transform: translateX(-50%);
                                        background: rgba(0,0,0,0.7);
                                        padding: 10px 20px;
                                        border-radius: 8px;
                                        color: white;
                                        font-size: 14px;
                                    }
                                    .filename {
                                        position: fixed;
                                        top: 20px;
                                        left: 50%;
                                        transform: translateX(-50%);
                                        background: rgba(0,0,0,0.7);
                                        padding: 8px 16px;
                                        border-radius: 6px;
                                        color: white;
                                        font-size: 13px;
                                    }
                                </style>
                            </head>
                            <body>
                                <div class="filename">${recording.name}</div>
                                <video controls autoplay>
                                    <source src="${recording.data}" type="video/webm">
                                    ë¸Œë¼ìš°ì €ê°€ ë¹„ë””ì˜¤ ì¬ìƒì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
                                </video>
                                <div class="controls">
                                    íŒŒì¼ í¬ê¸°: ${formatFileSize(recording.size)} | ë…¹í™” ì‹œê°„: ${recording.duration}
                                </div>
                            </body>
                            </html>
                        `);
                    } else {
                        alert('íŒì—…ì´ ì°¨ë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤. ë¸Œë¼ìš°ì € ì„¤ì •ì—ì„œ íŒì—…ì„ í—ˆìš©í•´ì£¼ì„¸ìš”.');
                    }
                }
            }
        }
        
        function downloadRecording(id) {
            const recording = recordingHistory.find(r => r.id == id);
            if (recording) {
                const a = document.createElement('a');
                // Base64 ë°ì´í„°ê°€ ìˆìœ¼ë©´ ì‚¬ìš©, ì—†ìœ¼ë©´ URL ì‚¬ìš©
                a.href = recording.data || recording.url;
                a.download = recording.name;
                a.click();
            }
        }
        
        function deleteRecording(id) {
            if (confirm('ì´ ë…¹í™” íŒŒì¼ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                recordingHistory = recordingHistory.filter(r => r.id != id);
                localStorage.setItem('recordingHistory', JSON.stringify(recordingHistory));
                updateHistoryUI();
            }
        }

        function startTimer() {
            timerInterval = setInterval(() => {
                const elapsed = Math.floor((Date.now() - startTime) / 1000);
                const minutes = Math.floor(elapsed / 60).toString().padStart(2, '0');
                const seconds = (elapsed % 60).toString().padStart(2, '0');
                // íƒ€ì´ë¨¸ í‘œì‹œ (í˜„ì¬ëŠ” ì½˜ì†”ì—ë§Œ ì¶œë ¥)
                console.log(`Recording time: ${minutes}:${seconds}`);
            }, 1000);
        }

        // ëª¨ë“œ ë²„íŠ¼ ì´ë²¤íŠ¸
        document.querySelectorAll('.mode-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                if (btn.id === 'settingsBtn') {
                    // ì„¤ì • ë²„íŠ¼ í´ë¦­ ì‹œ ëª¨ë‹¬ ì—´ê¸°
                    openSettingsModal();
                } else {
                    document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('selected'));
                    btn.classList.add('selected');
                }
            });
        });

        // ëª¨ë‹ˆí„° ì¹´ë“œ ì„ íƒ
        document.querySelectorAll('.monitor-card').forEach(card => {
            card.addEventListener('click', () => {
                document.querySelectorAll('.monitor-card').forEach(c => c.classList.remove('selected'));
                card.classList.add('selected');
            });
        });

        // íŒŒì¼ ì—´ê¸° ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
        openFileBtn.addEventListener('click', () => {
            fileInput.click();
        });

        // íŒŒì¼ ì„ íƒ ì‹œ ì²˜ë¦¬
        fileInput.addEventListener('change', (event) => {
            const file = event.target.files[0];
            if (file) {
                // ë¹„ë””ì˜¤ íŒŒì¼ ì²˜ë¦¬
                const url = URL.createObjectURL(file);
                
                // ìƒˆ ì°½ì—ì„œ ë¹„ë””ì˜¤ ì¬ìƒ
                const videoWindow = window.open('', '_blank', 'width=800,height=600');
                videoWindow.document.write(`
                    <!DOCTYPE html>
                    <html>
                    <head>
                        <title>${file.name} - REC FREE Player</title>
                        <style>
                            body {
                                margin: 0;
                                padding: 0;
                                background: #000;
                                display: flex;
                                justify-content: center;
                                align-items: center;
                                height: 100vh;
                            }
                            video {
                                max-width: 100%;
                                max-height: 100%;
                                width: auto;
                                height: auto;
                            }
                            .controls {
                                position: fixed;
                                bottom: 20px;
                                left: 50%;
                                transform: translateX(-50%);
                                background: rgba(0,0,0,0.7);
                                padding: 10px 20px;
                                border-radius: 8px;
                                color: white;
                                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
                                font-size: 14px;
                            }
                            .filename {
                                position: fixed;
                                top: 20px;
                                left: 50%;
                                transform: translateX(-50%);
                                background: rgba(0,0,0,0.7);
                                padding: 8px 16px;
                                border-radius: 6px;
                                color: white;
                                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
                                font-size: 13px;
                            }
                        </style>
                    </head>
                    <body>
                        <div class="filename">${file.name}</div>
                        <video controls autoplay>
                            <source src="${url}" type="${file.type}">
                            ë¸Œë¼ìš°ì €ê°€ ë¹„ë””ì˜¤ ì¬ìƒì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
                        </video>
                        <div class="controls">
                            íŒŒì¼ í¬ê¸°: ${(file.size / 1024 / 1024).toFixed(2)} MB
                        </div>
                    </body>
                    </html>
                `);
                
                // íŒŒì¼ ì…ë ¥ ì´ˆê¸°í™”
                event.target.value = '';
            }
        });
        
        // ìºì‹œ ì‚­ì œ ë²„íŠ¼
        const clearCacheBtn = document.getElementById('clearCacheBtn');
        clearCacheBtn.addEventListener('click', () => {
            if (confirm('ëª¨ë“  ë…¹í™” íˆìŠ¤í† ë¦¬ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')) {
                recordingHistory = [];
                localStorage.removeItem('recordingHistory');
                updateHistoryUI();
                alert('ìºì‹œê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
            }
        });
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ íˆìŠ¤í† ë¦¬ í‘œì‹œ
        window.addEventListener('load', () => {
            updateHistoryUI();
            // ë§ˆì´í¬ ë²„íŠ¼ ì´ˆê¸° ìƒíƒœ ì„¤ì •
            updateMicButton();
        });
        
        // ë§ˆì´í¬ ë²„íŠ¼ í† ê¸€
        micBtn.addEventListener('click', () => {
            appSettings.video.recordMic = !appSettings.video.recordMic;
            localStorage.setItem('appSettings', JSON.stringify(appSettings));
            updateMicButton();
            
            // ë…¹í™” ì¤‘ì´ë©´ ì•Œë¦¼ í‘œì‹œ
            if (isRecording) {
                alert('ë…¹í™” ì¤‘ì—ëŠ” ë§ˆì´í¬ ì„¤ì •ì„ ë³€ê²½í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\në‹¤ìŒ ë…¹í™”ë¶€í„° ì ìš©ë©ë‹ˆë‹¤.');
            }
        });
        
        // ë§ˆì´í¬ ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
        function updateMicButton() {
            if (appSettings.video.recordMic) {
                micBtn.classList.add('active');
                micBtn.classList.remove('mic-off');
                micBtn.innerHTML = '<i data-lucide="mic" class="control-icon"></i>';
                micBtn.title = 'ë§ˆì´í¬ ì¼œì§ (í´ë¦­: ë„ê¸°)';
            } else {
                micBtn.classList.remove('active');
                micBtn.classList.add('mic-off');
                micBtn.innerHTML = '<i data-lucide="mic-off" class="control-icon"></i>';
                micBtn.title = 'ë§ˆì´í¬ êº¼ì§ (í´ë¦­: ì¼œê¸°)';
            }
            lucide.createIcons();
        }

        // ì„¤ì • ê´€ë ¨ ë³€ìˆ˜ ë° í•¨ìˆ˜
        const settingsModal = document.getElementById('settingsModal');
        const closeSettingsBtn = document.getElementById('closeSettings');
        const cancelSettingsBtn = document.getElementById('cancelSettings');
        const saveSettingsBtn = document.getElementById('saveSettings');
        
        // ì„¤ì •ê°’ ì €ì¥ ê°ì²´
        let appSettings = JSON.parse(localStorage.getItem('appSettings') || JSON.stringify({
            general: {
                theme: 'dark',
                startupLaunch: false,
                excludeDesktopIcons: false,
                excludeSelf: true,
                countdown: false,
                countdownSeconds: 3,
                outputFolder: '/Users/sohee/Downloads/ë‹¤ë…¹ìŠ¤ì¿¨',
                showAfterRecord: true
            },
            video: {
                format: 'mp4',
                codec: 'h264',
                qualityMode: 'vbr',
                quality: 50,
                resolution: '5k',
                fps: 60,
                audioCodec: 'aac',
                audioBitrate: '256',
                recordSpeaker: true,
                recordMic: false
            },
            overlay: {
                showCursor: true,
                showWebcam: false,
                webcamMirror: false,
                webcamFlip: false
            },
            shortcuts: {
                record: '',
                window: '',
                stop: '',
                pause: ''
            }
        }));

        // ì„¤ì • ëª¨ë‹¬ ì—´ê¸°
        function openSettingsModal() {
            settingsModal.classList.add('active');
            loadSettings();
            lucide.createIcons();
        }

        // ì„¤ì • ëª¨ë‹¬ ë‹«ê¸°
        function closeSettingsModal() {
            settingsModal.classList.remove('active');
        }

        // ì„¤ì •ê°’ ë¶ˆëŸ¬ì˜¤ê¸°
        function loadSettings() {
            // ì¼ë°˜ ì„¤ì •
            document.getElementById('themeSelect').value = appSettings.general.theme;
            document.getElementById('startupCheck').checked = appSettings.general.startupLaunch;
            document.getElementById('desktopIconCheck').checked = appSettings.general.excludeDesktopIcons;
            document.getElementById('excludeSelfCheck').checked = appSettings.general.excludeSelf;
            document.getElementById('countdownCheck').checked = appSettings.general.countdown;
            document.getElementById('countdownValue').value = appSettings.general.countdownSeconds;
            document.getElementById('outputFolder').value = appSettings.general.outputFolder;
            document.getElementById('showAfterRecord').checked = appSettings.general.showAfterRecord;

            // ë¹„ë””ì˜¤ ì„¤ì •
            document.getElementById('formatSelect').value = appSettings.video.format;
            document.getElementById('codecSelect').value = appSettings.video.codec;
            document.getElementById('qualityMode').value = appSettings.video.qualityMode;
            document.getElementById('qualitySlider').value = appSettings.video.quality;
            document.getElementById('qualityValue').textContent = appSettings.video.quality;
            document.getElementById('resolutionSelect').value = appSettings.video.resolution;
            document.getElementById('fpsSelect').value = appSettings.video.fps;
            document.getElementById('audioCodec').value = appSettings.video.audioCodec;
            document.getElementById('audioBitrate').value = appSettings.video.audioBitrate;
            document.getElementById('speakerCheck').checked = appSettings.video.recordSpeaker;
            document.getElementById('micCheck').checked = appSettings.video.recordMic;

            // ì˜¤ë²„ë ˆì´ ì„¤ì •
            document.getElementById('cursorCheck').checked = appSettings.overlay.showCursor;
            document.getElementById('webcamCheck').checked = appSettings.overlay.showWebcam;
            document.getElementById('webcamMirror').checked = appSettings.overlay.webcamMirror;
            document.getElementById('webcamFlip').checked = appSettings.overlay.webcamFlip;

            // ë‹¨ì¶•í‚¤ ì„¤ì •
            document.getElementById('recordShortcut').value = appSettings.shortcuts.record;
            document.getElementById('windowShortcut').value = appSettings.shortcuts.window || '';
            document.getElementById('stopShortcut').value = appSettings.shortcuts.stop;
            document.getElementById('pauseShortcut').value = appSettings.shortcuts.pause || '';

            // ì›¹ìº  ì˜µì…˜ í‘œì‹œ/ìˆ¨ê¸°ê¸°
            const webcamSelect = document.getElementById('webcamSelect');
            const webcamOptions = document.getElementById('webcamOptions');
            if (appSettings.overlay.showWebcam) {
                webcamSelect.style.display = 'block';
                webcamOptions.style.display = 'block';
            }

            // ë§ˆì´í¬ ì˜µì…˜ í‘œì‹œ/ìˆ¨ê¸°ê¸°
            const micSelect = document.getElementById('micSelect');
            if (appSettings.video.recordMic) {
                micSelect.style.display = 'block';
            }
        }

        // ì„¤ì •ê°’ ì €ì¥
        function saveSettings() {
            // ì¼ë°˜ ì„¤ì •
            appSettings.general.theme = document.getElementById('themeSelect').value;
            appSettings.general.startupLaunch = document.getElementById('startupCheck').checked;
            appSettings.general.excludeDesktopIcons = document.getElementById('desktopIconCheck').checked;
            appSettings.general.excludeSelf = document.getElementById('excludeSelfCheck').checked;
            appSettings.general.countdown = document.getElementById('countdownCheck').checked;
            appSettings.general.countdownSeconds = parseInt(document.getElementById('countdownValue').value);
            appSettings.general.outputFolder = document.getElementById('outputFolder').value;
            appSettings.general.showAfterRecord = document.getElementById('showAfterRecord').checked;

            // ë¹„ë””ì˜¤ ì„¤ì •
            appSettings.video.format = document.getElementById('formatSelect').value;
            appSettings.video.codec = document.getElementById('codecSelect').value;
            appSettings.video.qualityMode = document.getElementById('qualityMode').value;
            appSettings.video.quality = parseInt(document.getElementById('qualitySlider').value);
            appSettings.video.resolution = document.getElementById('resolutionSelect').value;
            appSettings.video.fps = parseInt(document.getElementById('fpsSelect').value);
            appSettings.video.audioCodec = document.getElementById('audioCodec').value;
            appSettings.video.audioBitrate = document.getElementById('audioBitrate').value;
            appSettings.video.recordSpeaker = document.getElementById('speakerCheck').checked;
            appSettings.video.recordMic = document.getElementById('micCheck').checked;

            // ì˜¤ë²„ë ˆì´ ì„¤ì •
            appSettings.overlay.showCursor = document.getElementById('cursorCheck').checked;
            appSettings.overlay.showWebcam = document.getElementById('webcamCheck').checked;
            appSettings.overlay.webcamMirror = document.getElementById('webcamMirror').checked;
            appSettings.overlay.webcamFlip = document.getElementById('webcamFlip').checked;

            // ë‹¨ì¶•í‚¤ ì„¤ì •
            appSettings.shortcuts.record = document.getElementById('recordShortcut').value;
            appSettings.shortcuts.window = document.getElementById('windowShortcut').value;
            appSettings.shortcuts.stop = document.getElementById('stopShortcut').value;
            appSettings.shortcuts.pause = document.getElementById('pauseShortcut').value;

            // localStorageì— ì €ì¥
            localStorage.setItem('appSettings', JSON.stringify(appSettings));
            
            closeSettingsModal();
            applySettings();
        }

        // ì„¤ì • ì ìš©
        function applySettings() {
            // FPS ë° í•´ìƒë„ í‘œì‹œ ì—…ë°ì´íŠ¸
            const statusInfo = document.querySelector('.status-info');
            if (statusInfo) {
                const fpsValue = statusInfo.querySelector('.status-value:last-child');
                if (fpsValue) {
                    fpsValue.textContent = `${appSettings.video.fps}FPS`;
                }
                
                const resolutionMap = {
                    '5k': '5K',
                    '4k': '4K',
                    '1080p': 'FHD',
                    '720p': 'HD'
                };
                const resValue = statusInfo.querySelector('.status-value:first-child');
                if (resValue) {
                    resValue.textContent = resolutionMap[appSettings.video.resolution];
                }
            }
        }

        // íƒ­ ì „í™˜
        document.querySelectorAll('.settings-tab').forEach(tab => {
            tab.addEventListener('click', () => {
                const tabName = tab.dataset.tab;
                
                // íƒ­ í™œì„±í™”
                document.querySelectorAll('.settings-tab').forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                
                // íŒ¨ë„ ì „í™˜
                document.querySelectorAll('.settings-panel').forEach(panel => {
                    panel.classList.remove('active');
                });
                
                const panelMap = {
                    'general': 'generalPanel',
                    'video': 'videoPanel',
                    'overlay': 'overlayPanel',
                    'shortcuts': 'shortcutsPanel'
                };
                
                const activePanel = document.getElementById(panelMap[tabName]);
                if (activePanel) {
                    activePanel.classList.add('active');
                }
            });
        });

        // í’ˆì§ˆ ìŠ¬ë¼ì´ë” ì—…ë°ì´íŠ¸
        document.getElementById('qualitySlider').addEventListener('input', (e) => {
            document.getElementById('qualityValue').textContent = e.target.value;
        });

        // ì›¹ìº  ì²´í¬ë°•ìŠ¤ ë³€ê²½ ì‹œ
        document.getElementById('webcamCheck').addEventListener('change', (e) => {
            const webcamSelect = document.getElementById('webcamSelect');
            const webcamOptions = document.getElementById('webcamOptions');
            if (e.target.checked) {
                webcamSelect.style.display = 'block';
                webcamOptions.style.display = 'block';
            } else {
                webcamSelect.style.display = 'none';
                webcamOptions.style.display = 'none';
            }
        });

        // ë§ˆì´í¬ ì²´í¬ë°•ìŠ¤ ë³€ê²½ ì‹œ
        document.getElementById('micCheck').addEventListener('change', (e) => {
            const micSelect = document.getElementById('micSelect');
            if (e.target.checked) {
                micSelect.style.display = 'block';
            } else {
                micSelect.style.display = 'none';
            }
        });

        // ëª¨ë‹¬ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        closeSettingsBtn.addEventListener('click', closeSettingsModal);
        cancelSettingsBtn.addEventListener('click', closeSettingsModal);
        saveSettingsBtn.addEventListener('click', saveSettings);

        // ì´ˆê¸° ì„¤ì • ì ìš©
        applySettings();

        // ë‹¨ì¶•í‚¤ ì…ë ¥ ì²˜ë¦¬
        let currentShortcutInput = null;
        let recordingKeys = false;
        
        // ë‹¨ì¶•í‚¤ ì…ë ¥ í•„ë“œ í´ë¦­ ì´ë²¤íŠ¸
        document.querySelectorAll('.shortcut-input').forEach(input => {
            input.addEventListener('focus', (e) => {
                currentShortcutInput = e.target;
                recordingKeys = true;
                e.target.value = '';
                e.target.placeholder = 'í‚¤ ì¡°í•©ì„ ëˆ„ë¥´ì„¸ìš”...';
                e.target.style.background = '#4a4a4c';
            });
            
            input.addEventListener('blur', (e) => {
                recordingKeys = false;
                e.target.style.background = '#3a3a3c';
                
                // ê°’ì´ ì—†ìœ¼ë©´ ê¸°ì¡´ ê°’ ë³µì›
                if (!e.target.value) {
                    const action = e.target.dataset.action;
                    e.target.value = appSettings.shortcuts[action] || '';
                    e.target.placeholder = 'í´ë¦­ í›„ ë‹¨ì¶•í‚¤ ì…ë ¥';
                }
            });
        });
        
        // í‚¤ ì…ë ¥ ê°ì§€
        document.addEventListener('keydown', (e) => {
            if (recordingKeys && currentShortcutInput) {
                e.preventDefault();
                e.stopPropagation();
                
                const keys = [];
                
                // íŠ¹ìˆ˜í‚¤ ê°ì§€
                if (e.ctrlKey || e.metaKey) keys.push(e.metaKey ? 'âŒ˜' : 'Ctrl');
                if (e.altKey) keys.push(e.altKey ? 'âŒ¥' : 'Alt');
                if (e.shiftKey) keys.push('â‡§');
                
                // ì¼ë°˜ í‚¤ ì¶”ê°€
                if (e.key && !['Control', 'Alt', 'Shift', 'Meta', 'Command'].includes(e.key)) {
                    // íŠ¹ìˆ˜ í‚¤ ë§¤í•‘
                    const keyMap = {
                        'ArrowUp': 'â†‘',
                        'ArrowDown': 'â†“',
                        'ArrowLeft': 'â†',
                        'ArrowRight': 'â†’',
                        'Enter': 'â',
                        'Escape': 'ESC',
                        'Space': 'Space',
                        'Tab': 'Tab',
                        'Backspace': 'âŒ«',
                        'Delete': 'Del'
                    };
                    
                    const displayKey = keyMap[e.key] || e.key.toUpperCase();
                    keys.push(displayKey);
                }
                
                if (keys.length > 0) {
                    const shortcut = keys.join('+');
                    currentShortcutInput.value = shortcut;
                    
                    // Enter í‚¤ë¡œ í™•ì •
                    if (e.key === 'Enter' && keys.length === 1) {
                        currentShortcutInput.blur();
                    }
                }
            }
        });
        
        // ì „ì—­ ë‹¨ì¶•í‚¤ ë¦¬ìŠ¤ë„ˆ
        document.addEventListener('keydown', (e) => {
            // ì„¤ì • ëª¨ë‹¬ì´ ì—´ë ¤ìˆê±°ë‚˜ ì…ë ¥ ì¤‘ì´ë©´ ë¬´ì‹œ
            if (settingsModal.classList.contains('active') || recordingKeys) return;
            
            // ì…ë ¥ í•„ë“œì— í¬ì»¤ìŠ¤ê°€ ìˆìœ¼ë©´ ë¬´ì‹œ
            if (document.activeElement.tagName === 'INPUT' || 
                document.activeElement.tagName === 'TEXTAREA') return;
            
            const pressedKeys = [];
            if (e.ctrlKey || e.metaKey) pressedKeys.push(e.metaKey ? 'âŒ˜' : 'Ctrl');
            if (e.altKey) pressedKeys.push(e.altKey ? 'âŒ¥' : 'Alt');
            if (e.shiftKey) pressedKeys.push('â‡§');
            
            if (e.key && !['Control', 'Alt', 'Shift', 'Meta', 'Command'].includes(e.key)) {
                const keyMap = {
                    'ArrowUp': 'â†‘', 'ArrowDown': 'â†“', 'ArrowLeft': 'â†', 'ArrowRight': 'â†’',
                    'Enter': 'â', 'Escape': 'ESC', 'Space': 'Space', 'Tab': 'Tab',
                    'Backspace': 'âŒ«', 'Delete': 'Del'
                };
                pressedKeys.push(keyMap[e.key] || e.key.toUpperCase());
            }
            
            const shortcut = pressedKeys.join('+');
            
            // ë…¹í™” ì‹œì‘/ì¤‘ì§€
            if (shortcut === appSettings.shortcuts.record) {
                e.preventDefault();
                startBtn.click();
            }
            // ë…¹í™” ì¤‘ë‹¨
            else if (shortcut === appSettings.shortcuts.stop && isRecording) {
                e.preventDefault();
                stopBtn.click();
            }
            // ì¼ì‹œì •ì§€/ì¬ê°œ
            else if (shortcut === appSettings.shortcuts.pause && isRecording) {
                e.preventDefault();
                pauseBtn.click();
            }
        });

        // ì¹´ìš´íŠ¸ë‹¤ìš´ ê¸°ëŠ¥
        async function showCountdown() {
            if (!appSettings.general.countdown) return Promise.resolve();
            
            const countdownDiv = document.createElement('div');
            countdownDiv.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                font-size: 120px;
                font-weight: bold;
                color: #ff5252;
                z-index: 10000;
                background: rgba(0, 0, 0, 0.8);
                padding: 40px 60px;
                border-radius: 20px;
            `;
            document.body.appendChild(countdownDiv);
            
            for (let i = appSettings.general.countdownSeconds; i > 0; i--) {
                countdownDiv.textContent = i;
                await new Promise(resolve => setTimeout(resolve, 1000));
            }
            
            countdownDiv.remove();
        }

        // ì°½ ë“œë˜ê·¸ ê¸°ëŠ¥ (ë°ìŠ¤í¬í†±ì—ì„œë§Œ)
        let isDragging = false;
        let currentX;
        let currentY;
        let initialX;
        let initialY;
        let xOffset = 0;
        let yOffset = 0;
        
        const appContainer = document.querySelector('.app-container');
        const titleBar = document.querySelector('.title-bar');
        
        // ë°ìŠ¤í¬í†±ì—ì„œë§Œ ë“œë˜ê·¸ ê°€ëŠ¥
        if (window.innerWidth > 520) {
            titleBar.style.cursor = 'move';
            
            titleBar.addEventListener('mousedown', dragStart);
            document.addEventListener('mousemove', drag);
            document.addEventListener('mouseup', dragEnd);
        }
        
        function dragStart(e) {
            initialX = e.clientX - xOffset;
            initialY = e.clientY - yOffset;
            
            if (e.target === titleBar) {
                isDragging = true;
            }
        }
        
        function drag(e) {
            if (isDragging) {
                e.preventDefault();
                currentX = e.clientX - initialX;
                currentY = e.clientY - initialY;
                
                xOffset = currentX;
                yOffset = currentY;
                
                appContainer.style.transform = 'translate(' + currentX + 'px, ' + currentY + 'px)';
            }
        }
        
        function dragEnd(e) {
            initialX = currentX;
            initialY = currentY;
            isDragging = false;
        }
    </script>

    <!-- ì• ë“œì„¼ìŠ¤ ê´‘ê³  ì»¨í…Œì´ë„ˆ -->
    <div class="ad-container">
        <div class="ad-header">SPONSORED</div>

        <!-- Google AdSense ê´‘ê³  -->
        <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3297361889610977"
             crossorigin="anonymous"></script>
        <!-- í•˜ë£¨ì˜¤í”„ë ˆì½”ë” -->
        <ins class="adsbygoogle"
             style="display:block"
             data-ad-client="ca-pub-3297361889610977"
             data-ad-slot="7715083618"
             data-ad-format="horizontal"
             data-full-width-responsive="true"></ins>
        <script>
             (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
    </div>
</body>
</html>